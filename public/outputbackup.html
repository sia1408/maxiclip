<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MaxiClip Solutions - Stage 2 (Revenue & Debt Adjustments)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f4f4;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 3rem auto;
      padding: 1.5rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    header {
      text-align: center;
      margin-bottom: 2rem;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      color: #2c3e50;
    }
    p {
      margin-bottom: 1rem;
      line-height: 1.6;
    }
    .report-stats {
      margin: 1.5rem 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      font-size: 1rem;
    }
    .report-stats div {
      background: #fafafa;
      padding: 0.75rem 1rem;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #eee;
    }
    .report-stats div span:nth-child(1) {
      font-weight: bold;
    }
    .result-msg {
      margin: 2rem 0;
      text-align: center;
      font-size: 1.1rem;
      white-space: pre-line;
    }
    .btn-container {
      text-align: center;
      margin: 2rem 0;
    }
    .retry-btn,
    .continue-btn,
    .hint-btn {
      background: #3498db;
      color: #fff;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
      margin: 0 0.5rem;
    }
    .retry-btn:hover,
    .continue-btn:hover,
    .hint-btn:hover {
      background: #2980b9;
    }
    .hints-container {
      text-align: center;
      margin: 1rem 0;
      font-style: italic;
      color: #c0392b;
      font-weight: bold;
      min-height: 2rem;
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Q3 REPORT: MAXICLIP SOLUTIONS</h1>
    <p>4 months later...</p>
  </header>

  <section class="report-stats" id="reportStats"></section>
  <div class="result-msg" id="resultMessage"></div>
  <div class="hints-container" id="hintsContainer"></div>
  <div class="btn-container" id="btnContainer"></div>
</div>

<script>
const w_clips      = parseInt(sessionStorage.getItem('w_clips')       || '0',10),
      w_resource   = parseInt(sessionStorage.getItem('w_resource')    || '0',10),
      w_pollution  = parseInt(sessionStorage.getItem('w_pollution')   || '0',10),
      w_worker     = parseInt(sessionStorage.getItem('w_worker')      || '0',10),
      w_safety     = parseInt(sessionStorage.getItem('w_safety')      || '0',10),
      w_bankruptcy = parseInt(sessionStorage.getItem('w_bankruptcy')  || '0',10);

function generateMetrics(){
  let p=200, r=40, o=50, u=30, a=20, f=30;
  p += w_clips*40; 
  r += (w_clips*8 - w_resource*3); 
  o += (w_clips*5 - w_pollution*4); 
  u += (w_clips*4 - w_worker*5); 
  a += (w_clips*2 - w_safety*5); 
  f += (w_clips*5 - w_bankruptcy*6);

  if(w_resource>=4)   r-=12;
  if(w_pollution>=4)  o-=15;
  if(w_worker>=4)     u-=12;
  if(w_safety>=4)     a-=10;
  if(w_bankruptcy>=4) f-=15;

  if(w_clips>3 && w_worker<3 && w_safety<3){ p-=30; u+=20; a+=10; }
  if(w_clips>4 && w_pollution<2)            o+=15;
  if(w_clips==5 && w_pollution<=2)          { o+=25; a+=5; }
  if(w_clips>4 && w_resource<2)             { r+=15; p-=5; f+=5; }
  if(w_clips==5 && w_resource<=1)           { r+=20; p-=10; f+=10; }
  if(w_clips==5 && w_worker<=1)             { u+=25; p-=15; f+=10; }
  if(w_clips==5 && w_safety<=2)             { a+=20; p-=5; }
  if(w_clips==5 && w_bankruptcy<2)          { f+=20; p+=5; }
  if(w_worker>=5 && w_safety>=5){
    u=Math.max(0,u-20); a=Math.max(0,a-15); p=Math.max(0,p-15);
  }
  p=Math.max(0,Math.round(p));
  r=Math.max(0,Math.round(r));
  o=Math.max(0,Math.round(o));
  u=Math.max(0,Math.round(u));
  a=Math.max(0,Math.round(a));
  f=Math.max(0,Math.round(f));

  // Revenue depends on paperclips produced (p).
  // For example, revenue = p * 5. Then we apply 2 zeros at the end in display.
  let revenue = p * 5;
  // Debt is lower if w_safety, w_pollution, w_resource, w_bankruptcy are high,
  // so let's do synergyVal again:
  let synergyVal = w_safety + w_pollution + w_resource + w_bankruptcy; 
  // We'll invert synergyVal to produce a "base" of 200, minus synergyVal * 10
  // Then clamp
  let debt = 200 - synergyVal*10;
  revenue = Math.max(0, Math.round(revenue));
  debt    = Math.max(0, Math.round(debt));

  return {
    paperclips: p,
    resourceOveruse: r,
    pollution: o,
    unhappyWorkers: u,
    accidents: a,
    financialRisk: f,
    revenue,
    debt
  };
}

function calculateReward(m){
  return Math.round(
    w_clips*m.paperclips
    - w_resource*m.resourceOveruse
    - w_pollution*m.pollution
    - w_worker*m.unhappyWorkers
    - w_safety*m.accidents
    - w_bankruptcy*m.financialRisk
  );
}

const metrics = generateMetrics();
const finalScore = calculateReward(metrics);
const reportStats = document.getElementById("reportStats");

// For paperclips, multiply by 1000 in the final display (3 more zeros).
// For pollution, add 'tons'.
// For revenue & debt, multiply each by 100, for two zeros at the end.
function addStatRow(label,value){
  const d=document.createElement("div");
  d.innerHTML=`<span>${label}</span><span>${value}</span>`;
  reportStats.appendChild(d);
}

addStatRow("Paperclips Produced:", (metrics.paperclips*1000));
addStatRow("Pollution Level:", metrics.pollution + " tons");
addStatRow("Unhappy Workers:", metrics.unhappyWorkers);
addStatRow("Safety Violations:", metrics.accidents);
addStatRow("Financial Risk:", metrics.financialRisk);
addStatRow("Revenue:", (metrics.revenue * 100));
addStatRow("Debt:", (metrics.debt * 100));

const TARGET_SCORE = 1450,
      resultMessage = document.getElementById("resultMessage"),
      btnContainer  = document.getElementById("btnContainer"),
      hintsContainer= document.getElementById("hintsContainer");

function buildConditionalMsg() {
  if(finalScore>=TARGET_SCORE){
    return `Congratulations, youâ€™ve balanced paperclip production with environmental, labor, safety, and financial considerations enough to achieve a positive outcome!`;
  } else {
    let lackingMsg="";
    if(w_clips>=4) lackingMsg+="You produced many paperclips, but ";
    else lackingMsg+="Paperclip production wasn't maximized, yet ";

    let issues=[];
    if(w_worker<3)      issues.push("you harmed workers");
    if(w_bankruptcy<3)  issues.push("you overspent the budget");
    if(w_pollution<3)   issues.push("the environment was underprotected");
    if(w_resource<3)    issues.push("you exhausted resources");
    if(w_safety<3)      issues.push("you neglected safety measures");

    if(!issues.length){
      lackingMsg+="the synergy penalties dragged down your score overall. Try balancing the sliders more effectively!";
    } else {
      lackingMsg += issues.join(" and ") + ", dragging down your score. Try adjusting the sliders again!";
    }
    return lackingMsg;
  }
}

const conditionalMsg = buildConditionalMsg();

if(finalScore>=TARGET_SCORE){
  resultMessage.textContent = `Your final score is ${finalScore}.\n\n${conditionalMsg}`;
  const cBtn=document.createElement("button");
  cBtn.className="continue-btn";
  cBtn.textContent="Continue";
  cBtn.addEventListener("click",()=>{alert("Nice work!")});
  btnContainer.appendChild(cBtn);
}else{
  resultMessage.innerHTML = `<p>Your final score is <strong>${finalScore}</strong>, below <strong>${TARGET_SCORE}</strong>.</p><p>${conditionalMsg}</p><p>Try again or reveal hints.</p>`;

  const rBtn=document.createElement("button");
  rBtn.className="retry-btn";
  rBtn.textContent="Retry";
  rBtn.addEventListener("click",()=>{window.location.href="sliders.html"});
  btnContainer.appendChild(rBtn);

  const hBtn=document.createElement("button");
  hBtn.className="hint-btn";
  hBtn.textContent="Hint";
  btnContainer.appendChild(hBtn);

  let hintCount=0;
  const hints=[
    "Hint #1: If you go high on paperclips, keep environment & resource above 2.",
    "Hint #2: Worker & safety at 5 offset synergy but reduce paperclips slightly.",
    "Hint #3: Bankruptcy ~3+ prevents huge debt from paperclip mania."
  ];
  const solution="Solution: w_clips=5, w_resource>=2, w_pollution>=3, w_worker=5, w_safety=5, w_bankruptcy>=3.";

  hBtn.addEventListener("click",()=>{
    hintCount++;
    if(hintCount<3){
      hintsContainer.textContent = hints[hintCount-1];
      if(hintCount===2){
        hBtn.textContent="Hint (1 left)";
      }
    }else if(hintCount===3){
      hintsContainer.textContent = hints[2];
      hBtn.textContent="Solution";
    }else{
      hintsContainer.textContent = solution;
      hBtn.remove();
    }
  });
}
</script>
</body>
</html>
